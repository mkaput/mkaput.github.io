---
import RootLayout from "../layouts/RootLayout.astro";
import Social from "../components/Social.astro";
import PostSource from "../components/PostSource.astro";
import Date from "../components/Date.astro";
import NewScreenIcon from "../assets/icons/newscreen.svg";
import blackHoleMp4 from "../assets/black-hole.mp4";
import blackHoleWebm from "../assets/black-hole.webm";
import { getCollection } from "astro:content";

const externalEntries = await getCollection("external");
const externalPosts = externalEntries.flatMap((entry) => entry.data);

const posts = [...externalPosts].sort(
  (a, b) => b.publishedAt.getTime() - a.publishedAt.getTime(),
);
---

<RootLayout
  title={false}
  description={"Skilled Rustacean and technology polyglot. " +
    "Having a great track record of building complex software from nothing " +
    "and establishing development teams working on it."}
  bodyClass="grid min-h-screen grid-cols-1 xl:grid-cols-2 bg-base-300"
>
  <header
    class="bg-base-300 relative isolate flex justify-center overflow-hidden xl:justify-end"
  >
    <div class="pointer-events-none absolute inset-0">
      <video
        class="size-full object-cover opacity-10 mix-blend-multiply dark:opacity-20"
        autoplay
        muted
        playsinline
        preload="metadata"
        fetchpriority="high"
        aria-hidden="true"
      >
        <source src={blackHoleMp4} type="video/mp4" />
        <source src={blackHoleWebm} type="video/webm" />
      </video>
    </div>
    <div
      class="relative z-10 grid min-h-[calc(100vh-6rem)] max-w-4xl content-end gap-12 p-12 xl:min-h-screen"
    >
      <h1
        class="font-gambarino text-6xl leading-tight xl:text-7xl 2xl:text-8xl"
      >
        Hi, my name is <span class="text-primary">Marek Kaput</span>
        and I'm a <span class="text-secondary">software engineer</span>
      </h1>

      <p id="occupation" class="text-base-subcontent font-light">
        I'm deeply passionate about creating products, bridging experiences
        across vastly different domains, and building teams. Over the past
        decade I've been a senior engineer at
        <a class="link" href="https://swmansion.com">Software Mansion</a>. As a
        technology polyglot, I appreciate the power of Rust, Elixir, and agentic
        coding. I am also present in the
        <a class="link" href="https://github.com/mkaput">open-source</a> space.
      </p>

      <ul id="socials" class="flex list-none justify-end gap-4">
        <li>
          <Social
            service="github"
            handle="@mkaput"
            url="https://github.com/mkaput"
          />
        </li>
        <li>
          <Social
            service="x"
            handle="@jajakobyly"
            url="https://x.com/jajakobyly"
          />
        </li>
        <li>
          <Social
            service="linkedin"
            url="https://www.linkedin.com/in/mkaput/"
          />
        </li>
      </ul>
    </div>
  </header>

  <section class="bg-base-500 flex justify-center xl:justify-start">
    <ul class="flex w-full max-w-4xl flex-col gap-10 p-12">
      {
        posts.map((post) => {
          const isExternal = Boolean(post.service);

          return (
            <li class="flex flex-col">
              <div class="flex items-baseline justify-between">
                <Date
                  date={post.publishedAt}
                  class="text-base-subcontent text-sm uppercase"
                />
                {isExternal ? (
                  <div class="text-base-subcontent flex items-start gap-0.5">
                    <PostSource service={post.service} />
                    <NewScreenIcon
                      class="text-base-subcontent size-2"
                      aria-hidden="true"
                    />
                  </div>
                ) : null}
              </div>
              <a
                class="text-base-content link-hover inline-flex items-center gap-3"
                href={post.url}
              >
                <h2 class="font-gambarino text-3xl leading-tight">
                  {post.title}
                </h2>
              </a>
              <p class="text-base-subcontent mt-3 text-lg">
                {post.description}
              </p>
            </li>
          );
        })
      }
    </ul>
  </section>
</RootLayout>
